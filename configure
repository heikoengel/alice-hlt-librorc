#!/bin/bash

VERSION=`cat CMakeLists.txt | grep "set(VERSION" | awk '{print $2}' | cut -d")" -f1 | cut -d"\"" -f2`
INSTALL_PATH="/usr/"
MODE="SHARED"
BASEDIR=`pwd`/`dirname $0`
NOSHM="-DSHM=ON"

helptext()
{
    echo "Valid options are :"
    echo "--prefix=[path_to_install_locations]"
    echo "--static"
    echo "--noshm"
}


for VAR in "$@"
do
    COMMAND=`echo $VAR | cut -d= -f1`
    VALUE=`echo $VAR | cut -d= -f2`

    case "$COMMAND" in
        --prefix)
            INSTALL_PATH=$VALUE
        ;;

        --static)
            MODE="STATIC"
        ;;

        --noshm)
            NOSHM=""
        ;;


        --help)
            helptext
            exit 0
        ;;

        *)
            echo  "Unknown option $COMMAND"
            helptext
            exit 1
        ;;
     esac
done

mkdir -p $BASEDIR/build
mkdir -p $BASEDIR/build/debug
mkdir -p $BASEDIR/build/release
mkdir -p $BASEDIR/build/sim_debug
mkdir -p $BASEDIR/build/sim_release

cd $BASEDIR/build/release
cmake -DCMAKE_INSTALL_PREFIX:PATH=$INSTALL_PATH -DCMAKE_BUILD_TYPE=Release $NOSHM -DLIBMODE=$MODE ../../

cd $BASEDIR/build/debug
cmake -DCMAKE_INSTALL_PREFIX:PATH=$INSTALL_PATH -DCMAKE_BUILD_TYPE=Debug $NOSHM -DLIBMODE=$MODE ../../

cd $BASEDIR/build/sim_release
cmake -DCMAKE_INSTALL_PREFIX:PATH=$INSTALL_PATH -DCMAKE_BUILD_TYPE=Release -DMODELSIM=ON $NOSHM -DLIBMODE=$MODE ../../

cd $BASEDIR/build/sim_debug
cmake -DCMAKE_INSTALL_PREFIX:PATH=$INSTALL_PATH -DCMAKE_BUILD_TYPE=Debug -DMODELSIM=ON $NOSHM -DLIBMODE=$MODE ../../

cd $BASEDIR
